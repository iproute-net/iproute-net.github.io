<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
    <title>blog.iproute.net</title>
    <subtitle>Welcome to blog.iproute.net. My name is Keyvan and working as a Senior Network Engineer. This blog has real-life stories, study notes, and helpful tips. We will explore the exciting world of networks together!</subtitle>
    <link rel="self" type="application/atom+xml" href="https://blog.iproute.net/atom.xml"/>
    <link rel="alternate" type="text/html" href="https://blog.iproute.net"/>
    <generator uri="https://www.getzola.org/">Zola</generator>
    <updated>2023-08-11T09:19:42+00:00</updated>
    <id>https://blog.iproute.net/atom.xml</id>
    <entry xml:lang="en">
        <title>Running big Datacenter Scenarios via containerlab</title>
        <published>2023-08-11T09:19:42+00:00</published>
        <updated>2023-08-11T09:19:42+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://blog.iproute.net/posts/running-big-datacenter-scenarios-via-containerlab/"/>
        <id>https://blog.iproute.net/posts/running-big-datacenter-scenarios-via-containerlab/</id>
        
        <content type="html" xml:base="https://blog.iproute.net/posts/running-big-datacenter-scenarios-via-containerlab/">&lt;p&gt;In this article I want to share some tips I faced in using clab(&lt;a href=&quot;https:&#x2F;&#x2F;containerlab.dev&quot;&gt;&lt;em&gt;Containerlab&lt;&#x2F;em&gt;&lt;&#x2F;a&gt;).
I am using &lt;strong&gt;CentOS Stream release 8&lt;&#x2F;strong&gt; in an old server with Gen1 intel xeon (Intel(R) Xeon(R) CPU E5-2640 0 @ 2.50GHz) and 128GB of RAM.
I used Arista cEOS 4.27.3F. 
some of the scenarios are explained here: &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;arista-netdevops-community&#x2F;avd-cEOS-Lab&quot;&gt;&lt;em&gt;Arista Validated design with cEOS-lab&lt;&#x2F;em&gt;&lt;&#x2F;a&gt; &lt;&#x2F;p&gt;
&lt;h2 id=&quot;tip-1&quot;&gt;Tip#1:&lt;&#x2F;h2&gt;
&lt;p&gt;In versions prior to EOS-4.28.0F, the ceos-lab image requires a cgroups v1 environment.
You need to add &amp;quot;systemd.unified_cgroup_hierarchy=0&amp;quot; to your kernel parameters. This is achieved by editing &#x2F;etc&#x2F;default&#x2F;grub line like this:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;GRUB_CMDLINE_LINUX_DEFAULT=&amp;quot;quiet splash systemd.unified_cgroup_hierarchy=0&amp;quot;
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;then run &#x27;sudo update-grub&#x27; and reboot.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;tip-2&quot;&gt;Tip#2:&lt;&#x2F;h2&gt;
&lt;p&gt;If you have a big Scenario you may faced some issue in the performance and your system crashed with some errors like: 
&lt;strong&gt;&amp;quot;coredump datagram&amp;quot;&lt;&#x2F;strong&gt; , &lt;strong&gt;&amp;quot;inotify cannot be used, reverting to polling: Too many open files&amp;quot;&lt;&#x2F;strong&gt;
These problems also related to some default configuration in Arista cEOS.
I have identified a problem in cEOS, when it starts, it modifies some parameters (see file &#x2F;etc&#x2F;sysconfig&#x2F;99-eos.conf of the image) and in particular &#x2F;proc&#x2F;sys&#x2F;fs&#x2F;inotify&#x2F;max_user_instances to 1256 I solved the problem by modifying this file on the host and by adding a &amp;quot;binds&amp;quot; example : &lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;topology: 
&lt;&#x2F;span&gt;&lt;span&gt;  nodes: ceos: 
&lt;&#x2F;span&gt;&lt;span&gt;    kind: ceos 
&lt;&#x2F;span&gt;&lt;span&gt;    image: ceos:4.26.3M 
&lt;&#x2F;span&gt;&lt;span&gt;    binds: - &#x2F;myhomelabspath&#x2F;my-99-eos.conf:&#x2F;etc&#x2F;sysconfig&#x2F;99-eos.conf	
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;In my local file (my-99-eos.conf), I changed: fs.inotify.max_user_instances=from 1256 to 65536&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;fs.inotify.max_user_instances=65536
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;tip-3&quot;&gt;Tip#3:&lt;&#x2F;h2&gt;
&lt;p&gt;if you have too many images to run simultaneously  you may have concern about the resources you can set &lt;a href=&quot;https:&#x2F;&#x2F;containerlab.dev&#x2F;manual&#x2F;vrnetlab&#x2F;#boot-delay&quot;&gt;&lt;em&gt;bootdely&lt;&#x2F;em&gt;&lt;&#x2F;a&gt;
also if you are using a linux and wants to have lacp you have to added this one to &lt;strong&gt;env&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;nodes:
&lt;&#x2F;span&gt;&lt;span&gt;  server1:
&lt;&#x2F;span&gt;&lt;span&gt;    kind: linux
&lt;&#x2F;span&gt;&lt;span&gt;    mgmt-ipv4: 172.30.255.29
&lt;&#x2F;span&gt;&lt;span&gt;    mgmt-ipv6: 1001:172:30:255::29
&lt;&#x2F;span&gt;&lt;span&gt;    env:
&lt;&#x2F;span&gt;&lt;span&gt;      TMODE: lacp
&lt;&#x2F;span&gt;&lt;span&gt;      BOOT_DELAY: 300
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;h2 id=&quot;tip-4&quot;&gt;Tip#4:&lt;&#x2F;h2&gt;
&lt;p&gt;if your scenario is really huge and have maybe hundreds of switches you can cluster somehow the containerlab.
for this purpose you can use &lt;a href=&quot;https:&#x2F;&#x2F;containerlab.dev&#x2F;manual&#x2F;multi-node&quot;&gt;&lt;em&gt;Multi-node labs&lt;&#x2F;em&gt;&lt;&#x2F;a&gt;
you may follow the examples in the above link, but some more tips is here to help you.&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;topology:
&lt;&#x2F;span&gt;&lt;span&gt;  kinds:
&lt;&#x2F;span&gt;&lt;span&gt;    ceos:
&lt;&#x2F;span&gt;&lt;span&gt;      image: ceos:4.27.3F
&lt;&#x2F;span&gt;&lt;span&gt;  nodes:
&lt;&#x2F;span&gt;&lt;span&gt;    sw02:
&lt;&#x2F;span&gt;&lt;span&gt;      kind: ceos
&lt;&#x2F;span&gt;&lt;span&gt;      mgmt_ipv4: 172.210.100.102
&lt;&#x2F;span&gt;&lt;span&gt;      mgmt_ipv6: 1001:172:210:100::102
&lt;&#x2F;span&gt;&lt;span&gt;      binds:
&lt;&#x2F;span&gt;&lt;span&gt;        - .&#x2F;99-ceos.conf:&#x2F;etc&#x2F;sysctl.d&#x2F;99-eos_k1.conf
&lt;&#x2F;span&gt;&lt;span&gt;    br-e1:
&lt;&#x2F;span&gt;&lt;span&gt;      kind: bridge
&lt;&#x2F;span&gt;&lt;span&gt;    br-e2:
&lt;&#x2F;span&gt;&lt;span&gt;      kind: bridge
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span&gt;  links:
&lt;&#x2F;span&gt;&lt;span&gt;    - endpoints: [&amp;quot;sw02:eth1&amp;quot;, &amp;quot;br-e1:e1&amp;quot;]
&lt;&#x2F;span&gt;&lt;span&gt;    - endpoints: [&amp;quot;sw02:eth2&amp;quot;, &amp;quot;br-e2:e2&amp;quot;]
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;now you need to follow this steps:&lt;&#x2F;p&gt;
&lt;ol&gt;
&lt;li&gt;create some bridges in your linux machine &lt;&#x2F;li&gt;
&lt;li&gt;connect the physical interface to a switch &lt;&#x2F;li&gt;
&lt;li&gt;allow required vlan on the port (if it is trunk). in below example I used vlan 11 and 12
do the same steps in the second machine.&lt;&#x2F;li&gt;
&lt;&#x2F;ol&gt;
&lt;h3 id=&quot;creating-bridges-in-linux&quot;&gt;creating bridges in Linux:&lt;&#x2F;h3&gt;
&lt;pre style=&quot;background-color:#2b303b;color:#c0c5ce;&quot;&gt;&lt;code&gt;&lt;span&gt;ip link add br-e2 type bridge
&lt;&#x2F;span&gt;&lt;span&gt;ip link add br-e1 type bridge
&lt;&#x2F;span&gt;&lt;span&gt;ip link set up br-e1
&lt;&#x2F;span&gt;&lt;span&gt;ip link set up br-e2
&lt;&#x2F;span&gt;&lt;span&gt;ip link add link eno1 name eno1.11 type vlan id 11
&lt;&#x2F;span&gt;&lt;span&gt;ip link add link eno1 name eno1.12 type vlan id 12
&lt;&#x2F;span&gt;&lt;span&gt;ip link set dev eno1.11 master br-e1
&lt;&#x2F;span&gt;&lt;span&gt;ip link set dev eno1.12 master br-e2
&lt;&#x2F;span&gt;&lt;span&gt;ip link set up eno1.11
&lt;&#x2F;span&gt;&lt;span&gt;ip link set up eno1.12
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
</content>
        
    </entry>
    <entry xml:lang="en">
        <title>Keyvan Ghadimi</title>
        <published>2021-04-01T08:50:45+00:00</published>
        <updated>2021-04-01T08:50:45+00:00</updated>
        
        <author>
          <name>
            
              Unknown
            
          </name>
        </author>
        
        <link rel="alternate" type="text/html" href="https://blog.iproute.net/authors/keyvan-ghadimi/"/>
        <id>https://blog.iproute.net/authors/keyvan-ghadimi/</id>
        
        <content type="html" xml:base="https://blog.iproute.net/authors/keyvan-ghadimi/">&lt;p&gt;&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;iproute-net&quot;&gt;@iproute_net&lt;&#x2F;a&gt;&lt;&#x2F;p&gt;
</content>
        
    </entry>
</feed>
